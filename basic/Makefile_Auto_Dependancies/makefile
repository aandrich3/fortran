# Makefile with autodependancy generation
# Note: Before running, you need to install fortdepend `pip install fortdepend` 
# 		fortdepend path can vary so make sure you edit the MAKEDEPEND variable

## Compiler Flags
FC=gfortran		# Fortran Compiler
FFLAGS=-O2 -g -Wall -Wextra
LINKER = $(FC) -o
FCLINKS = -g 
#FFLAGS=-Wall -Wextra -fopenmp		# OpenMP

# $(DEP_FILE) is a .dep file generated by fort_depend.py
DEP_FILE = my_project.dep
PROG = main.exe 

# Source files to compile
SOURCES := $(shell find $(SOURCE_DIR) -name '*.F90')
OBJECTS := $(SOURCES:.F90=.o)

## Auto Generation of Dependancies 
MAKEDEPEND = ~/anaconda3/envs/dev/bin/fortdepend
depend:=$(shell $(MAKEDEPEND) -o $(DEP_FILE))

include $(DEP_FILE)

# Make all Targets
all: $(PROG)

$(PROG) : $(OBJECTS)
	@echo "-----------------------------"
	@echo "Creating the executable"
	@echo "-----------------------------"
	$(LINKER) $(PROG) $(OBJECTS) $(FCLINKS)

%.o : %.F90
	@echo "-----------------------------"
	@echo "Compiling the files into objects"
	@echo "-----------------------------"
	$(FC) $(FFLAGS) -c $<

clean:
	rm -r *.mod *.o *.exe *.dep