# Makefile with autodependancy generation
# Note: Before running, you need to install fortdepend `pip install fortdepend` 
# 		fortdepend path can vary so make sure you edit the MAKEDEPEND variable

## Compiler Flags
FC=gfortran		# Fortran Compiler
FFLAGS= -g -Wall -Wextra # -O2  # Note: Compiler optimization flags like -O2 will interfere with debugging
LINKER = $(FC) -o
FCLINKS = -g 
#FFLAGS=-Wall -Wextra -fopenmp		# OpenMP

# $(DEP_FILE) is a .dep file generated by fort_depend.py
DEP_FILE = my_project.dep
PROG = main.exe

# Source files to compile
SOURCES := $(shell find $(SOURCE_DIR) -name '*.f95')
OBJECTS := $(SOURCES:.f95=.o)

## Auto Generation of Dependancies 
MAKEDEPEND=~/anaconda3/envs/dev/bin/fortdepend
depend:=$(shell $(MAKEDEPEND) -f $(SOURCES) -o $(DEP_FILE))

include $(DEP_FILE)

# Make all Targets
all: $(PROG)

%.o : %.f95
	@echo "-----------------------------"
	@echo "Compiling the files into objects"
	@echo "-----------------------------"
	$(FC) $(FFLAGS) -c $<

$(PROG) : $(OBJECTS)
	@echo "-----------------------------"
	@echo "Creating the executable"
	@echo "-----------------------------"
	$(LINKER) $(PROG) $(OBJECTS) $(FCLINKS)

clean:
	rm -r *.mod *.o *.exe *.dep